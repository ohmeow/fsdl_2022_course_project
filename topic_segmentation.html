<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>course_copilot - topic_segmentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="course_copilot - topic_segmentation">
<meta property="og:description" content="source">
<meta property="og:site-name" content="course_copilot">
<meta name="twitter:title" content="course_copilot - topic_segmentation">
<meta name="twitter:description" content="source">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">course_copilot</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">topic_segmentation</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">fsdl_2022_course_project</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link">utils</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preprocessing.html" class="sidebar-item-text sidebar-link">preprocessing</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./training.html" class="sidebar-item-text sidebar-link">training</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transcription.html" class="sidebar-item-text sidebar-link">transcription</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./topic_segmentation.html" class="sidebar-item-text sidebar-link active">topic_segmentation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summarization.html" class="sidebar-item-text sidebar-link">summarization</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tasks.html" class="sidebar-item-text sidebar-link">tasks</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#configuration" id="toc-configuration" class="nav-link active" data-scroll-target="#configuration">Configuration</a>
  <ul class="collapse">
  <li><a href="#topicsegmentationconfig" id="toc-topicsegmentationconfig" class="nav-link" data-scroll-target="#topicsegmentationconfig">TopicSegmentationConfig</a></li>
  </ul></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#hugging-face-transformers-objects" id="toc-hugging-face-transformers-objects" class="nav-link" data-scroll-target="#hugging-face-transformers-objects">Hugging Face <code>transformers</code> objects</a></li>
  <li><a href="#dataloaders" id="toc-dataloaders" class="nav-link" data-scroll-target="#dataloaders"><code>DataLoaders</code></a>
  <ul class="collapse">
  <li><a href="#siamesebatchtokenizetransform" id="toc-siamesebatchtokenizetransform" class="nav-link" data-scroll-target="#siamesebatchtokenizetransform">SiameseBatchTokenizeTransform</a></li>
  </ul></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models">Models</a>
  <ul class="collapse">
  <li><a href="#blurr_splitter_on_backbone" id="toc-blurr_splitter_on_backbone" class="nav-link" data-scroll-target="#blurr_splitter_on_backbone">blurr_splitter_on_backbone</a></li>
  <li><a href="#blurr_splitter_with_head" id="toc-blurr_splitter_with_head" class="nav-link" data-scroll-target="#blurr_splitter_with_head">blurr_splitter_with_head</a></li>
  <li><a href="#marginrankingloss" id="toc-marginrankingloss" class="nav-link" data-scroll-target="#marginrankingloss">MarginRankingLoss</a></li>
  <li><a href="#topic_seg_f1_score" id="toc-topic_seg_f1_score" class="nav-link" data-scroll-target="#topic_seg_f1_score">topic_seg_f1_score</a></li>
  <li><a href="#topicsegmentationmodelwrapper" id="toc-topicsegmentationmodelwrapper" class="nav-link" data-scroll-target="#topicsegmentationmodelwrapper">TopicSegmentationModelWrapper</a></li>
  </ul></li>
  <li><a href="#learner" id="toc-learner" class="nav-link" data-scroll-target="#learner"><code>Learner</code></a></li>
  <li><a href="#validation" id="toc-validation" class="nav-link" data-scroll-target="#validation">Validation</a>
  <ul class="collapse">
  <li><a href="#depth_score_cal" id="toc-depth_score_cal" class="nav-link" data-scroll-target="#depth_score_cal">depth_score_cal</a></li>
  </ul></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference">Inference</a></li>
  <li><a href="#model-trainer" id="toc-model-trainer" class="nav-link" data-scroll-target="#model-trainer">Model Trainer</a>
  <ul class="collapse">
  <li><a href="#topicsegmentationmodeltrainer" id="toc-topicsegmentationmodeltrainer" class="nav-link" data-scroll-target="#topicsegmentationmodeltrainer">TopicSegmentationModelTrainer</a></li>
  <li><a href="#train" id="toc-train" class="nav-link" data-scroll-target="#train"><code>train</code></a></li>
  <li><a href="#topicsegmentationmodeltrainer.train" id="toc-topicsegmentationmodeltrainer.train" class="nav-link" data-scroll-target="#topicsegmentationmodeltrainer.train">TopicSegmentationModelTrainer.train</a></li>
  <li><a href="#get_preds" id="toc-get_preds" class="nav-link" data-scroll-target="#get_preds"><code>get_preds</code></a></li>
  <li><a href="#topicsegmentationmodeltrainer.get_preds" id="toc-topicsegmentationmodeltrainer.get_preds" class="nav-link" data-scroll-target="#topicsegmentationmodeltrainer.get_preds">TopicSegmentationModelTrainer.get_preds</a></li>
  <li><a href="#tune" id="toc-tune" class="nav-link" data-scroll-target="#tune"><code>tune</code></a></li>
  <li><a href="#tune_threshold" id="toc-tune_threshold" class="nav-link" data-scroll-target="#tune_threshold"><code>tune_threshold</code></a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/ohmeow/fsdl_2022_course_project/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">topic_segmentation</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>What we're running with at the time this documentation was generated:
torch: 1.12.1+cu102
fastai: 2.7.9
transformers: 4.22.0</code></pre>
</div>
</div>
<section id="configuration" class="level2">
<h2 class="anchored" data-anchor-id="configuration">Configuration</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(os.environ[<span class="st">"WANDB_PROJECT_NAME"</span>])</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(os.environ[<span class="st">"WANDB_TEAM"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>course-copilot-ml
course-copilot</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/ohmeow/fsdl_2022_course_project/blob/master/course_copilot/topic_segmentation.py#L64" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="topicsegmentationconfig" class="level3">
<h3 class="anchored" data-anchor-id="topicsegmentationconfig">TopicSegmentationConfig</h3>
<blockquote class="blockquote">
<pre><code> TopicSegmentationConfig ()</code></pre>
</blockquote>
<p>A <code>training.TrainConfig</code> object training and tuning our segmentation models. Uses fastai and huggingface defaults by default</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ExampleCFG(TopicSegmentationConfig):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    training_subset <span class="op">=</span> <span class="fl">0.25</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    n_frozen_epochs <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    n_unfrozen_epochs <span class="op">=</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>[<span class="ss">f"</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> k, v <span class="kw">in</span> training.get_train_config_props(ExampleCFG).items()][:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['accum: None',
 'adam_beta2: 0.99',
 'adam_eps: 1e-07',
 'batch_size: 8',
 "custom_model_kwargs: {'p': 0.1, 'dropout_cls': &lt;class 'torch.nn.modules.dropout.Dropout'&gt;}"]</code></pre>
</div>
</div>
</section>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>train_df, trn_idxs, val_idxs, raw_train_df <span class="op">=</span> _get_training_data(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    ExampleCFG, data_dir<span class="op">=</span><span class="st">"../data"</span>, on_the_fly<span class="op">=</span><span class="va">False</span>, split_type<span class="op">=</span><span class="st">"cross_validation"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(train_df))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(trn_idxs), <span class="bu">len</span>(val_idxs))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>train_df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6196
4981 1215</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>index</th>
      <th>course_title</th>
      <th>lesson_num</th>
      <th>topic</th>
      <th>seq</th>
      <th>prev_seq</th>
      <th>next_seq</th>
      <th>is_topic_end</th>
      <th>next_topic_begin_seq</th>
      <th>other_topic_seqs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>23538</td>
      <td>parker - learn photography</td>
      <td>1</td>
      <td>Apertures Deep Dive</td>
      <td>particular the detroit tigers so their wedding day was in that area</td>
      <td>and if you recognize this letter d you know that's from detroit and in</td>
      <td>and we were near the detroit tiger stadium if i had completely blurred out</td>
      <td>False</td>
      <td>NaN</td>
      <td>[you fully understand how they work and how they can alter your final image now previously i demonstrated that the, larger the aperture the more the background is blurred out when it comes to the area in focus this is referred to, as the depth of field so the depth of field is the zone within a photo that, appears sharp and in focus when focusing on your subject that is considered the point of focus beyond that, how much appears in focus corresponds to the depth of field so here are two more, images and the amount of the depth of field in one is greater than the other, the first image i ca...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6466</td>
      <td>Full Stack Deep Learning - Spring 2021</td>
      <td>9</td>
      <td>Long Term Ethical Problems in AI</td>
      <td>we basically need robots in order to have a functioning economy in the next few decades</td>
      <td>brilliant person and this article which i recommend you click on talks about how</td>
      <td>an interesting spin on this worry though is ai not necessarily replacing human labor</td>
      <td>False</td>
      <td>NaN</td>
      <td>[a.i so the first i think a lot of people's minds go to autonomous weapons and maybe they go into a place that, is a little easy to dismiss as maybe far-fetched not realistic we don't have to worry about it it's just a movie, but of course as the saying goes the future is already here it's just not evenly distributed so, israel apparently has autonomous robo snipers on their borders today and just, i think last weekend or something there was an article about the new york city police deploying, the boston dynamics spot robot which actually anyone can buy now i think it's only like, 60 000 o...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="hugging-face-transformers-objects" class="level2">
<h2 class="anchored" data-anchor-id="hugging-face-transformers-objects">Hugging Face <code>transformers</code> objects</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>hf_arch, hf_config, hf_tokenizer, hf_model <span class="op">=</span> _get_task_hf_objects(ExampleCFG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dataloaders" class="level2">
<h2 class="anchored" data-anchor-id="dataloaders"><code>DataLoaders</code></h2>
<hr>
<p><a href="https://github.com/ohmeow/fsdl_2022_course_project/blob/master/course_copilot/topic_segmentation.py#L289" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="siamesebatchtokenizetransform" class="level3">
<h3 class="anchored" data-anchor-id="siamesebatchtokenizetransform">SiameseBatchTokenizeTransform</h3>
<blockquote class="blockquote">
<pre><code> SiameseBatchTokenizeTransform (use_next_pos_prob:float=0.75,
                                use_adjacent_neg_prob:float=0.5, **kwargs)</code></pre>
</blockquote>
<p>Handles everything you need to assemble a mini-batch of inputs and targets, as well as decode the dictionary produced as a byproduct of the tokenization process in the <code>encodes</code> method.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>use_next_pos_prob</td>
<td>float</td>
<td>0.75</td>
<td>The probability we’ll use the positive examples next sequence vs another sequence in the same topic</td>
</tr>
<tr class="even">
<td>use_adjacent_neg_prob</td>
<td>float</td>
<td>0.5</td>
<td>The probability we’ll use the negative example’s sequence in another topic vs.&nbsp;sequence in a completely different course</td>
</tr>
<tr class="odd">
<td>kwargs</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> _get_dls(ExampleCFG, train_df, hf_arch, hf_config, hf_tokenizer, hf_model, val_idxs_or_fold<span class="op">=</span>val_idxs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> dls.one_batch()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(b))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">""</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(hf_tokenizer.decode(b[<span class="dv">0</span>][<span class="st">"input_ids"</span>][<span class="dv">0</span>]))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">""</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(hf_tokenizer.decode(b[<span class="dv">1</span>][<span class="st">"input_ids"</span>][<span class="dv">0</span>]))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">""</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3

[CLS] of three of them so, you know, you kind of... this is the idea, right?, as if somebody says to you: “i like this movie, this movie, this movie” and you're like: “oh, they like those movies too” what[SEP] other movies do you like? and they'll say: “oh, how about this?” there's a chance, good chance, that you're going to like the same thing. that's the basis of collaborative filtering, okay, it's...[SEP]

[CLS] of three of them so, you know, you kind of... this is the idea, right?, as if somebody says to you: “i like this movie, this movie, this movie” and you're like: “oh, they like those movies too” what[SEP] you're going to be really hungry and[SEP][PAD][PAD][PAD][PAD][PAD][PAD][PAD][PAD][PAD][PAD][PAD][PAD][PAD][PAD][PAD][PAD]

TensorCategory([0, 0, 0, 0, 0, 0, 0, 0], device='cuda:1')</code></pre>
</div>
</div>
</section>
</section>
<section id="models" class="level2">
<h2 class="anchored" data-anchor-id="models">Models</h2>
<hr>
<p><a href="https://github.com/ohmeow/fsdl_2022_course_project/blob/master/course_copilot/topic_segmentation.py#L397" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="blurr_splitter_on_backbone" class="level3">
<h3 class="anchored" data-anchor-id="blurr_splitter_on_backbone">blurr_splitter_on_backbone</h3>
<blockquote class="blockquote">
<pre><code> blurr_splitter_on_backbone (m:fastai.torch_core.Module)</code></pre>
</blockquote>
<p>Creates two layer groups: One for the backbone and one for the pooler/classification head</p>
<hr>
<p><a href="https://github.com/ohmeow/fsdl_2022_course_project/blob/master/course_copilot/topic_segmentation.py#L387" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="blurr_splitter_with_head" class="level3">
<h3 class="anchored" data-anchor-id="blurr_splitter_with_head">blurr_splitter_with_head</h3>
<blockquote class="blockquote">
<pre><code> blurr_splitter_with_head (m:fastai.torch_core.Module)</code></pre>
</blockquote>
<p>Simply adds an additional layer group to the classification head</p>
<hr>
<p><a href="https://github.com/ohmeow/fsdl_2022_course_project/blob/master/course_copilot/topic_segmentation.py#L409" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="marginrankingloss" class="level3">
<h3 class="anchored" data-anchor-id="marginrankingloss">MarginRankingLoss</h3>
<blockquote class="blockquote">
<pre><code> MarginRankingLoss (pos_neg_scores, targs)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/ohmeow/fsdl_2022_course_project/blob/master/course_copilot/topic_segmentation.py#L418" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="topic_seg_f1_score" class="level3">
<h3 class="anchored" data-anchor-id="topic_seg_f1_score">topic_seg_f1_score</h3>
<blockquote class="blockquote">
<pre><code> topic_seg_f1_score (inps, targs)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/ohmeow/fsdl_2022_course_project/blob/master/course_copilot/topic_segmentation.py#L434" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="topicsegmentationmodelwrapper" class="level3">
<h3 class="anchored" data-anchor-id="topicsegmentationmodelwrapper">TopicSegmentationModelWrapper</h3>
<blockquote class="blockquote">
<pre><code> TopicSegmentationModelWrapper (hf_config:PretrainedConfig,
                                hf_model:PreTrainedModel,
                                dropout_cls:type=&lt;class
                                'torch.nn.modules.dropout.Dropout'&gt;,
                                p:float=0.1, hf_model_kwargs:dict={})</code></pre>
</blockquote>
<p>This custom <code>BaseModelWrapper</code> allows to score our positive examples against our negative examples. A good model will be one where the former are assigned a value greater than the later.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>hf_config</td>
<td>PretrainedConfig</td>
<td></td>
<td>Our transformer’s configuration object</td>
</tr>
<tr class="even">
<td>hf_model</td>
<td>PreTrainedModel</td>
<td></td>
<td>Our transformer model</td>
</tr>
<tr class="odd">
<td>dropout_cls</td>
<td>type</td>
<td>Dropout</td>
<td>The class we want to use for applying dropout</td>
</tr>
<tr class="even">
<td>p</td>
<td>float</td>
<td>0.1</td>
<td>The amount of dropout to apply prior to our classification head</td>
</tr>
<tr class="odd">
<td>hf_model_kwargs</td>
<td>dict</td>
<td>{}</td>
<td>Any kwargs we want to be passed when the model is used for prediction</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="learner" class="level2">
<h2 class="anchored" data-anchor-id="learner"><code>Learner</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> _get_learner(cfg<span class="op">=</span>ExampleCFG, dls<span class="op">=</span>dls, hf_config<span class="op">=</span>hf_config, hf_model<span class="op">=</span>hf_model, learner_path<span class="op">=</span><span class="st">"../models"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>fit_cbs <span class="op">=</span> []</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> ExampleCFG.max_grad_norm:</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    fit_cbs.append(GradientClip(max_norm<span class="op">=</span>ExampleCFG.max_grad_norm))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> ExampleCFG.include_gradient_checkpointing:</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    fit_cbs.append(GradientCheckpointing())</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> ExampleCFG.save_best_model:</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    fit_cbs.append(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        SaveModelCallback(</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>            monitor<span class="op">=</span><span class="st">"valid_loss"</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>            comp<span class="op">=</span>np.less,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>            fname<span class="op">=</span><span class="ss">f"temp_best_loss_topic_segmentation"</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>            reset_on_fit<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(learn.opt.param_groups))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># learn.unfreeze()</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># learn.summary()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>learn.unfreeze()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>learn.lr_find(suggest_funcs<span class="op">=</span>[minimum, steep, valley, slide])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<pre><code>SuggestedLRs(minimum=1.0964781722577755e-07, steep=0.005248074419796467, valley=0.00013182566908653826, slide=0.0014454397605732083)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="20_topic_segmentation_files/figure-html/cell-22-output-4.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> ExampleCFG.random_seed:</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    set_seed(ExampleCFG.random_seed)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>learn.fit_one_cycle(<span class="dv">2</span>, <span class="bu">slice</span>(<span class="fl">1e-5</span>, <span class="fl">1e-3</span>), cbs<span class="op">=</span>fit_cbs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>topic_seg_f1_score</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.456956</td>
      <td>0.556683</td>
      <td>0.781070</td>
      <td>01:25</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.335876</td>
      <td>0.568177</td>
      <td>0.772840</td>
      <td>01:25</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Better model found at epoch 0 with valid_loss value: 0.5566829442977905.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>[<span class="ss">f"</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> k, v <span class="kw">in</span> training.get_train_config_props(ExampleCFG).items()][:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['accum: None',
 'adam_beta2: 0.99',
 'adam_eps: 1e-07',
 'batch_size: 8',
 "custom_model_kwargs: {'p': 0.1, 'dropout_cls': &lt;class 'torch.nn.modules.dropout.Dropout'&gt;}"]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> m_name, m_val <span class="kw">in</span> <span class="bu">zip</span>(learn.recorder.metric_names[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>], learn.recorder.final_record):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(m_name, m_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>train_loss 0.33587607741355896
valid_loss 0.5681771039962769
topic_seg_f1_score 0.7728395061728395</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>learn.recorder.plot_loss()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="20_topic_segmentation_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>learn.export(<span class="st">"../models/test_topic_segmentation.pkl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="validation" class="level2">
<h2 class="anchored" data-anchor-id="validation">Validation</h2>
<hr>
<p><a href="https://github.com/ohmeow/fsdl_2022_course_project/blob/master/course_copilot/topic_segmentation.py#L525" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="depth_score_cal" class="level3">
<h3 class="anchored" data-anchor-id="depth_score_cal">depth_score_cal</h3>
<blockquote class="blockquote">
<pre><code> depth_score_cal (scores)</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 84%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>scores</td>
<td>The original scores assigned to each sequence in a course’s transcript</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>val_course_titles <span class="op">=</span> train_df.iloc[val_idxs][<span class="st">"course_title"</span>].unique().tolist()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>preds_df <span class="op">=</span> _get_validation_preds(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    hf_model,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    hf_tokenizer,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    raw_train_df,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    val_course_titles[:<span class="dv">2</span>],</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">16</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    threshold_std_coeff<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(preds_df))</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>preds_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4628</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>level_0</th>
      <th>index</th>
      <th>course_title</th>
      <th>lesson_num</th>
      <th>topic</th>
      <th>seq</th>
      <th>prev_seq</th>
      <th>next_seq</th>
      <th>is_topic_end</th>
      <th>next_topic_begin_seq</th>
      <th>other_topic_seqs</th>
      <th>depth_score</th>
      <th>threshold</th>
      <th>pred_start</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>19012</td>
      <td>19012</td>
      <td>markowskyart - begginer drawing course</td>
      <td>1</td>
      <td>Introduction</td>
      <td>okay here we are welcome everybody wherever you are here on planet Earth</td>
      <td>xxBEGIN_TOPICxx</td>
      <td>I'm welcoming you into my studio here in Vancouver British Columbia Canada my</td>
      <td>False</td>
      <td>NaN</td>
      <td>[name is Michael Markowski and I'm gonna be your drawing instructor for the next, hour or month depending on how many classes you decide to watch so it's, really exciting that there's I see 50 people who are watching right now which is really exciting to have a nice big, audience worth of people and I don't know how many comments have been pouring in here I was looking at a few of those, right started and people from a lot of people from British Columbia and it's great also to see a bunch of people who, have taken classes with me in the past so I guess that might mean I'm possibly, have do...</td>
      <td>0.001695</td>
      <td>0.00322</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>19013</td>
      <td>19013</td>
      <td>markowskyart - begginer drawing course</td>
      <td>1</td>
      <td>Introduction</td>
      <td>I'm welcoming you into my studio here in Vancouver British Columbia Canada my</td>
      <td>okay here we are welcome everybody wherever you are here on planet Earth</td>
      <td>name is Michael Markowski and I'm gonna be your drawing instructor for the next</td>
      <td>False</td>
      <td>NaN</td>
      <td>[okay here we are welcome everybody wherever you are here on planet Earth, hour or month depending on how many classes you decide to watch so it's, really exciting that there's I see 50 people who are watching right now which is really exciting to have a nice big, audience worth of people and I don't know how many comments have been pouring in here I was looking at a few of those, right started and people from a lot of people from British Columbia and it's great also to see a bunch of people who, have taken classes with me in the past so I guess that might mean I'm possibly, have done some...</td>
      <td>0.000806</td>
      <td>0.00322</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>19014</td>
      <td>19014</td>
      <td>markowskyart - begginer drawing course</td>
      <td>1</td>
      <td>Introduction</td>
      <td>name is Michael Markowski and I'm gonna be your drawing instructor for the next</td>
      <td>I'm welcoming you into my studio here in Vancouver British Columbia Canada my</td>
      <td>hour or month depending on how many classes you decide to watch so it's</td>
      <td>False</td>
      <td>NaN</td>
      <td>[okay here we are welcome everybody wherever you are here on planet Earth, I'm welcoming you into my studio here in Vancouver British Columbia Canada my, really exciting that there's I see 50 people who are watching right now which is really exciting to have a nice big, audience worth of people and I don't know how many comments have been pouring in here I was looking at a few of those, right started and people from a lot of people from British Columbia and it's great also to see a bunch of people who, have taken classes with me in the past so I guess that might mean I'm possibly, have don...</td>
      <td>0.000616</td>
      <td>0.00322</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>19015</td>
      <td>19015</td>
      <td>markowskyart - begginer drawing course</td>
      <td>1</td>
      <td>Introduction</td>
      <td>hour or month depending on how many classes you decide to watch so it's</td>
      <td>name is Michael Markowski and I'm gonna be your drawing instructor for the next</td>
      <td>really exciting that there's I see 50 people who are watching right now which is really exciting to have a nice big</td>
      <td>False</td>
      <td>NaN</td>
      <td>[okay here we are welcome everybody wherever you are here on planet Earth, I'm welcoming you into my studio here in Vancouver British Columbia Canada my, name is Michael Markowski and I'm gonna be your drawing instructor for the next, audience worth of people and I don't know how many comments have been pouring in here I was looking at a few of those, right started and people from a lot of people from British Columbia and it's great also to see a bunch of people who, have taken classes with me in the past so I guess that might mean I'm possibly, have done something right in the past and pe...</td>
      <td>0.000000</td>
      <td>0.00322</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>19016</td>
      <td>19016</td>
      <td>markowskyart - begginer drawing course</td>
      <td>1</td>
      <td>Introduction</td>
      <td>really exciting that there's I see 50 people who are watching right now which is really exciting to have a nice big</td>
      <td>hour or month depending on how many classes you decide to watch so it's</td>
      <td>audience worth of people and I don't know how many comments have been pouring in here I was looking at a few of those</td>
      <td>False</td>
      <td>NaN</td>
      <td>[okay here we are welcome everybody wherever you are here on planet Earth, I'm welcoming you into my studio here in Vancouver British Columbia Canada my, name is Michael Markowski and I'm gonna be your drawing instructor for the next, hour or month depending on how many classes you decide to watch so it's, right started and people from a lot of people from British Columbia and it's great also to see a bunch of people who, have taken classes with me in the past so I guess that might mean I'm possibly, have done something right in the past and people who've taken my photography, classes and ...</td>
      <td>0.004914</td>
      <td>0.00322</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="inference" class="level2">
<h2 class="anchored" data-anchor-id="inference">Inference</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>raw_train_df <span class="op">=</span> pd.read_csv(<span class="ss">f"../data/clean/segmentation_train.csv"</span>, index_col<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>val_course_title <span class="op">=</span> <span class="st">"fast.ai 2022 - Part 1"</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>val_lesson_num <span class="op">=</span> <span class="st">"4"</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>inf_df <span class="op">=</span> raw_train_df[</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    (raw_train_df[<span class="st">"course_title"</span>] <span class="op">==</span> val_course_title) <span class="op">&amp;</span> (raw_train_df[<span class="st">"lesson_num"</span>] <span class="op">==</span> val_lesson_num)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>inf_df[<span class="st">"transcript"</span>] <span class="op">=</span> inf_df[<span class="st">"seq"</span>]</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>inf_df.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(inf_df))</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>inf_df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>709</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>index</th>
      <th>course_title</th>
      <th>lesson_num</th>
      <th>topic</th>
      <th>seq</th>
      <th>prev_seq</th>
      <th>next_seq</th>
      <th>is_topic_end</th>
      <th>next_topic_begin_seq</th>
      <th>other_topic_seqs</th>
      <th>transcript</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>15307</td>
      <td>fast.ai 2022 - Part 1</td>
      <td>4</td>
      <td>Using Huggingface</td>
      <td>Hi everybody, and welcome to Practical Deep Learning for Coders Lesson Four, which I think</td>
      <td>xxBEGIN_TOPICxx</td>
      <td>is the lesson that a lot of the regulars in the community have been most excited about,</td>
      <td>False</td>
      <td>NaN</td>
      <td>["because it's where we're gonna get some totally new material — totally new topic, we've", "never covered before. We're going to cover natural language processing (NLP), and you'll", "find there, there is indeed a chapter about that in the book, but we're going to do it in a totally different way to how it's done in the book. In the book we do NLP using the", 'fast.ai library, using recurrent neural networks (RNNs).', "Today we're going to do something else, which is we're going to do Transformers, and we're", "not even going to use the fast.ai library at all in fact. So, what we're going...</td>
      <td>Hi everybody, and welcome to Practical Deep Learning for Coders Lesson Four, which I think</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15308</td>
      <td>fast.ai 2022 - Part 1</td>
      <td>4</td>
      <td>Using Huggingface</td>
      <td>is the lesson that a lot of the regulars in the community have been most excited about,</td>
      <td>Hi everybody, and welcome to Practical Deep Learning for Coders Lesson Four, which I think</td>
      <td>because it's where we're gonna get some totally new material — totally new topic, we've</td>
      <td>False</td>
      <td>NaN</td>
      <td>['Hi everybody, and welcome to Practical Deep Learning for Coders Lesson Four, which I think', "never covered before. We're going to cover natural language processing (NLP), and you'll", "find there, there is indeed a chapter about that in the book, but we're going to do it in a totally different way to how it's done in the book. In the book we do NLP using the", 'fast.ai library, using recurrent neural networks (RNNs).', "Today we're going to do something else, which is we're going to do Transformers, and we're", "not even going to use the fast.ai library at all in fact. So, what we're go...</td>
      <td>is the lesson that a lot of the regulars in the community have been most excited about,</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>preds_df, seg_idxs <span class="op">=</span> _get_preds(learn, inf_df, threshold_std_coeff<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(seg_idxs[:<span class="dv">10</span>])</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(preds_df))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>preds_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0, 4, 16, 20, 23, 26, 30, 44, 47, 54]
709</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>index</th>
      <th>course_title</th>
      <th>lesson_num</th>
      <th>topic</th>
      <th>seq</th>
      <th>prev_seq</th>
      <th>next_seq</th>
      <th>is_topic_end</th>
      <th>next_topic_begin_seq</th>
      <th>other_topic_seqs</th>
      <th>transcript</th>
      <th>depth_score</th>
      <th>threshold</th>
      <th>pred_start</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>15307</td>
      <td>fast.ai 2022 - Part 1</td>
      <td>4</td>
      <td>Using Huggingface</td>
      <td>Hi everybody, and welcome to Practical Deep Learning for Coders Lesson Four, which I think</td>
      <td>xxBEGIN_TOPICxx</td>
      <td>is the lesson that a lot of the regulars in the community have been most excited about,</td>
      <td>False</td>
      <td>NaN</td>
      <td>["because it's where we're gonna get some totally new material — totally new topic, we've", "never covered before. We're going to cover natural language processing (NLP), and you'll", "find there, there is indeed a chapter about that in the book, but we're going to do it in a totally different way to how it's done in the book. In the book we do NLP using the", 'fast.ai library, using recurrent neural networks (RNNs).', "Today we're going to do something else, which is we're going to do Transformers, and we're", "not even going to use the fast.ai library at all in fact. So, what we're going...</td>
      <td>Hi everybody, and welcome to Practical Deep Learning for Coders Lesson Four, which I think</td>
      <td>0.001369</td>
      <td>0.002255</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15308</td>
      <td>fast.ai 2022 - Part 1</td>
      <td>4</td>
      <td>Using Huggingface</td>
      <td>is the lesson that a lot of the regulars in the community have been most excited about,</td>
      <td>Hi everybody, and welcome to Practical Deep Learning for Coders Lesson Four, which I think</td>
      <td>because it's where we're gonna get some totally new material — totally new topic, we've</td>
      <td>False</td>
      <td>NaN</td>
      <td>['Hi everybody, and welcome to Practical Deep Learning for Coders Lesson Four, which I think', "never covered before. We're going to cover natural language processing (NLP), and you'll", "find there, there is indeed a chapter about that in the book, but we're going to do it in a totally different way to how it's done in the book. In the book we do NLP using the", 'fast.ai library, using recurrent neural networks (RNNs).', "Today we're going to do something else, which is we're going to do Transformers, and we're", "not even going to use the fast.ai library at all in fact. So, what we're go...</td>
      <td>is the lesson that a lot of the regulars in the community have been most excited about,</td>
      <td>0.000000</td>
      <td>0.002255</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>15309</td>
      <td>fast.ai 2022 - Part 1</td>
      <td>4</td>
      <td>Using Huggingface</td>
      <td>because it's where we're gonna get some totally new material — totally new topic, we've</td>
      <td>is the lesson that a lot of the regulars in the community have been most excited about,</td>
      <td>never covered before. We're going to cover natural language processing (NLP), and you'll</td>
      <td>False</td>
      <td>NaN</td>
      <td>['Hi everybody, and welcome to Practical Deep Learning for Coders Lesson Four, which I think', 'is the lesson that a lot of the regulars in the community have been most excited about,', "find there, there is indeed a chapter about that in the book, but we're going to do it in a totally different way to how it's done in the book. In the book we do NLP using the", 'fast.ai library, using recurrent neural networks (RNNs).', "Today we're going to do something else, which is we're going to do Transformers, and we're", "not even going to use the fast.ai library at all in fact. So, what we're goi...</td>
      <td>because it's where we're gonna get some totally new material — totally new topic, we've</td>
      <td>0.000203</td>
      <td>0.002255</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15310</td>
      <td>fast.ai 2022 - Part 1</td>
      <td>4</td>
      <td>Using Huggingface</td>
      <td>never covered before. We're going to cover natural language processing (NLP), and you'll</td>
      <td>because it's where we're gonna get some totally new material — totally new topic, we've</td>
      <td>find there, there is indeed a chapter about that in the book, but we're going to do it in a totally different way to how it's done in the book. In the book we do NLP using the</td>
      <td>False</td>
      <td>NaN</td>
      <td>['Hi everybody, and welcome to Practical Deep Learning for Coders Lesson Four, which I think', 'is the lesson that a lot of the regulars in the community have been most excited about,', "because it's where we're gonna get some totally new material — totally new topic, we've", 'fast.ai library, using recurrent neural networks (RNNs).', "Today we're going to do something else, which is we're going to do Transformers, and we're", "not even going to use the fast.ai library at all in fact. So, what we're going to be", "doing today is we're going to be fine-tuning a pre-trained NLP model using a...</td>
      <td>never covered before. We're going to cover natural language processing (NLP), and you'll</td>
      <td>0.001102</td>
      <td>0.002255</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>15311</td>
      <td>fast.ai 2022 - Part 1</td>
      <td>4</td>
      <td>Using Huggingface</td>
      <td>find there, there is indeed a chapter about that in the book, but we're going to do it in a totally different way to how it's done in the book. In the book we do NLP using the</td>
      <td>never covered before. We're going to cover natural language processing (NLP), and you'll</td>
      <td>fast.ai library, using recurrent neural networks (RNNs).</td>
      <td>False</td>
      <td>NaN</td>
      <td>['Hi everybody, and welcome to Practical Deep Learning for Coders Lesson Four, which I think', 'is the lesson that a lot of the regulars in the community have been most excited about,', "because it's where we're gonna get some totally new material — totally new topic, we've", "never covered before. We're going to cover natural language processing (NLP), and you'll", "Today we're going to do something else, which is we're going to do Transformers, and we're", "not even going to use the fast.ai library at all in fact. So, what we're going to be", "doing today is we're going to be fine-tuning...</td>
      <td>find there, there is indeed a chapter about that in the book, but we're going to do it in a totally different way to how it's done in the book. In the book we do NLP using the</td>
      <td>0.002383</td>
      <td>0.002255</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">del</span> learn</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    gc.collect()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    torch.cuda.empty_cache()</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-trainer" class="level2">
<h2 class="anchored" data-anchor-id="model-trainer">Model Trainer</h2>
<hr>
<p><a href="https://github.com/ohmeow/fsdl_2022_course_project/blob/master/course_copilot/topic_segmentation.py#L769" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="topicsegmentationmodeltrainer" class="level3">
<h3 class="anchored" data-anchor-id="topicsegmentationmodeltrainer">TopicSegmentationModelTrainer</h3>
<blockquote class="blockquote">
<pre><code> TopicSegmentationModelTrainer (experiment_name:str,
                                train_config:__main__.TopicSegmentationCon
                                fig, data_path:str='data',
                                model_output_path:str='models',
                                log_output_path:str='logs',
                                log_preds:bool=False,
                                log_n_preds:int=None,
                                use_wandb:bool=False, verbose:bool=False,
                                **kwargs)</code></pre>
</blockquote>
<p>Helper class that provides a standard way to create an ABC using inheritance.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>experiment_name</td>
<td>str</td>
<td></td>
<td>The name of your experiment (e.g., deberta_v3_large). This value is used in conjunction with <code>task</code> when<br>logging information with W&amp;B or else saving data releveant to training/evaluation runs</td>
</tr>
<tr class="even">
<td>train_config</td>
<td>TopicSegmentationConfig</td>
<td></td>
<td>The <a href="https://ohmeow.github.io/course_copilot/topic_segmentation.html#topicsegmentationconfig"><code>TopicSegmentationConfig</code></a></td>
</tr>
<tr class="odd">
<td>data_path</td>
<td>str</td>
<td>data</td>
<td>Where the project’s data is stored</td>
</tr>
<tr class="even">
<td>model_output_path</td>
<td>str</td>
<td>models</td>
<td>Where exported Learners and other models should stored</td>
</tr>
<tr class="odd">
<td>log_output_path</td>
<td>str</td>
<td>logs</td>
<td>Where any logged data should be stored</td>
</tr>
<tr class="even">
<td>log_preds</td>
<td>bool</td>
<td>False</td>
<td>Whether predictions should be logged</td>
</tr>
<tr class="odd">
<td>log_n_preds</td>
<td>int</td>
<td>None</td>
<td>The number of course predictions that should be logged</td>
</tr>
<tr class="even">
<td>use_wandb</td>
<td>bool</td>
<td>False</td>
<td>Whether or not to log experiments and sweeps to W&amp;B</td>
</tr>
<tr class="odd">
<td>verbose</td>
<td>bool</td>
<td>False</td>
<td>Whether or not you want to have printed out everything during a training/evaulation run</td>
</tr>
<tr class="even">
<td>kwargs</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="train" class="level3">
<h3 class="anchored" data-anchor-id="train"><code>train</code></h3>
<hr>
<p><a href="https://github.com/ohmeow/fsdl_2022_course_project/blob/master/course_copilot/topic_segmentation.py#L844" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="topicsegmentationmodeltrainer.train" class="level3">
<h3 class="anchored" data-anchor-id="topicsegmentationmodeltrainer.train">TopicSegmentationModelTrainer.train</h3>
<blockquote class="blockquote">
<pre><code> TopicSegmentationModelTrainer.train (sweep_config:dict=None)</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>sweep_config</td>
<td>dict</td>
<td>None</td>
<td>A dictionary providing the parameters and ranges for our sweep</td>
</tr>
</tbody>
</table>
<p>Example training code</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>trainer <span class="op">=</span> TopicSegmentationModelTrainer(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    experiment_name<span class="op">=</span><span class="st">"test_topic_segmentation"</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    train_config<span class="op">=</span>ExampleCFG,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    data_path<span class="op">=</span><span class="st">"../data"</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    model_output_path<span class="op">=</span><span class="st">"../models"</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    log_output_path<span class="op">=</span><span class="st">"../logs"</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    log_preds<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    log_n_preds<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    use_wandb<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>results_df, raw_df, train_df, train_val_idxs <span class="op">=</span> trainer.train()</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>results_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Failed to detect the name of this notebook, you can set it manually with the WANDB_NOTEBOOK_NAME environment variable to enable code saving.
wandb: Currently logged in as: ohmeow. Use `wandb login --relogin` to force relogin
wandb: Currently logged in as: ohmeow (course-copilot). Use `wandb login --relogin` to force relogin</code></pre>
</div>
<div class="cell-output cell-output-display">
wandb version 0.13.4 is available!  To upgrade, please run:
 $ pip install wandb --upgrade
</div>
<div class="cell-output cell-output-display">
Tracking run with wandb version 0.13.3
</div>
<div class="cell-output cell-output-display">
Run data is saved locally in <code>../logs/wandb/run-20221010_131156-mz9oyjue</code>
</div>
<div class="cell-output cell-output-display">
Syncing run <strong><a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/mz9oyjue" target="_blank">tough-eon-1</a></strong> to <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation" target="_blank">Weights &amp; Biases</a> (<a href="https://wandb.me/run" target="_blank">docs</a>)<br>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Experiment: test_topic_segmentation
Training config: f{'accum': None, 'adam_beta2': 0.99, 'adam_eps': 1e-07, 'batch_size': 8, 'custom_model_kwargs': {'p': 0.1, 'dropout_cls': &lt;class 'torch.nn.modules.dropout.Dropout'&gt;}, 'frozen_lr': 0, 'hf_config_kwargs': {'num_labels': 2}, 'hf_model_checkpoint': 'microsoft/deberta-v3-small', 'hf_model_cls': 'AutoModelForSequenceClassification', 'hf_model_kwargs': {}, 'hf_tokenizer_kwargs': {}, 'include_gradient_checkpointing': False, 'include_labels': False, 'lower_case': True, 'max_grad_norm': None, 'max_length': True, 'n_frozen_epochs': 0, 'n_unfrozen_epochs': 2, 'new_special_tokens': None, 'one_cycle_moms_end': 0.8, 'one_cycle_moms_min': 0.7, 'one_cycle_moms_start': 0.8, 'only_seed_splits': True, 'preprocess_strategy': None, 'random_seed': 2022, 'save_best_model': True, 'tok_kwargs': {}, 'training_subset': 0.25, 'truncation_strategy': True, 'unfrozen_lr_max': 0.001, 'unfrozen_lr_min': 1e-05, 'use_adjacent_neg_prob': 0.5, 'use_fp16': True, 'use_next_pos_prob': 0.75, 'val_pct': 0.25, 'weight_decay': 0.0}
Preparing training data ...
Building HF objects ...
Building DataLoaders ...
Building Learner ...
Training ...
Could not gather input dimensions</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>topic_seg_f1_score</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.462488</td>
      <td>0.582567</td>
      <td>0.768724</td>
      <td>01:27</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.384275</td>
      <td>0.571569</td>
      <td>0.759671</td>
      <td>01:28</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Better model found at epoch 0 with valid_loss value: 0.5825673341751099.
Better model found at epoch 1 with valid_loss value: 0.5715688467025757.
Could not gather input dimensions</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-stdout">
<pre><code>Logging results ...
Getting predictions for validatation set ...
processing markowskyart - begginer drawing course: 1
processing markowskyart - begginer drawing course: 2
processing markowskyart - begginer drawing course: 3
processing markowskyart - begginer drawing course: 4
processing markowskyart - begginer drawing course: 5
processing cc - how to invest in stocks: 1
Saving model ...</code></pre>
</div>
<div class="cell-output cell-output-display">
Waiting for W&amp;B process to finish... <strong style="color:green">(success).</strong>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4d8f8bd2e7754791b3a970ab472903f4","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">

<style>
    table.wandb td:nth-child(1) { padding: 0 10px; text-align: left ; width: auto;} td:nth-child(2) {text-align: left ; width: 100%}
    .wandb-row { display: flex; flex-direction: row; flex-wrap: wrap; justify-content: flex-start; width: 100% }
    .wandb-col { display: flex; flex-direction: column; flex-basis: 100%; flex: 1; padding: 10px; }
    </style>
<div class="wandb-row"><div class="wandb-col"><h3 class="anchored">Run history:</h3><br><table class="wandb"><tbody><tr><td>epoch</td><td>▁▁▁▁▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▄▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇███</td></tr><tr><td>eps_0</td><td>▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁</td></tr><tr><td>eps_1</td><td>▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁</td></tr><tr><td>lr_0</td><td>▁▁▂▃▄▅▆▇▇██████▇▇▇▇▆▆▆▆▅▅▄▄▄▃▃▃▂▂▂▂▁▁▁▁▁</td></tr><tr><td>lr_1</td><td>▁▁▂▃▄▅▆▇▇██████▇▇▇▇▆▆▆▆▅▅▄▄▄▃▃▃▂▂▂▂▁▁▁▁▁</td></tr><tr><td>mom_0</td><td>██▇▇▅▄▃▂▂▁▁▁▁▁▁▂▂▂▂▃▃▃▃▄▄▅▅▅▆▆▆▇▇▇▇█████</td></tr><tr><td>mom_1</td><td>██▇▇▅▄▃▂▂▁▁▁▁▁▁▂▂▂▂▃▃▃▃▄▄▅▅▅▆▆▆▇▇▇▇█████</td></tr><tr><td>raw_loss</td><td>███▇▇▅█▃▄▂▂█▇▇▃▃▁▂▃▁▁▄▅▁▂▃▄▃▅▃▆▂▃▄▃▃▁▆▅▆</td></tr><tr><td>sqr_mom_0</td><td>▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁</td></tr><tr><td>sqr_mom_1</td><td>▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁</td></tr><tr><td>topic_seg_f1_score</td><td>█▁</td></tr><tr><td>train_loss</td><td>█████▇▆▄▄▄▃▃▃▃▃▃▃▂▂▂▂▂▂▂▂▁▂▂▂▂▂▁▁▁▁▂▂▂▂▂</td></tr><tr><td>train_samples_per_sec</td><td>▁▄▅█▂▅█▄▆▄▇▅▄█▅█▅▃▇▇▃▄▃▅▅▃▄▃▄▅▃▅▆▆▇▅▅▆▂▂</td></tr><tr><td>valid_loss</td><td>█▁</td></tr><tr><td>wd_0</td><td>▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁</td></tr><tr><td>wd_1</td><td>▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁</td></tr></tbody></table><br></div><div class="wandb-col"><h3 class="anchored">Run summary:</h3><br><table class="wandb"><tbody><tr><td>epoch</td><td>2</td></tr><tr><td>eps_0</td><td>0.0</td></tr><tr><td>eps_1</td><td>0.0</td></tr><tr><td>lr_0</td><td>0.0</td></tr><tr><td>lr_1</td><td>0.0</td></tr><tr><td>mom_0</td><td>0.8</td></tr><tr><td>mom_1</td><td>0.8</td></tr><tr><td>raw_loss</td><td>0.19263</td></tr><tr><td>sqr_mom_0</td><td>0.99</td></tr><tr><td>sqr_mom_1</td><td>0.99</td></tr><tr><td>state</td><td>completed</td></tr><tr><td>topic_seg_f1_score</td><td>0.75802</td></tr><tr><td>train_loss</td><td>0.38427</td></tr><tr><td>train_samples_per_sec</td><td>28.17576</td></tr><tr><td>valid_loss</td><td>0.5866</td></tr><tr><td>wd_0</td><td>0.0</td></tr><tr><td>wd_1</td><td>0.0</td></tr></tbody></table><br></div></div>
</div>
<div class="cell-output cell-output-display">
Synced <strong style="color:#cdcd00">tough-eon-1</strong>: <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/mz9oyjue" target="_blank">https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/mz9oyjue</a><br>Synced 6 W&amp;B file(s), 1 media file(s), 1 artifact file(s) and 0 other file(s)
</div>
<div class="cell-output cell-output-display">
Find logs at: <code>../logs/wandb/run-20221010_131156-mz9oyjue/logs</code>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>End training</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>accum</th>
      <th>adam_beta2</th>
      <th>adam_eps</th>
      <th>batch_size</th>
      <th>custom_model_kwargs</th>
      <th>frozen_lr</th>
      <th>hf_config_kwargs</th>
      <th>hf_model_checkpoint</th>
      <th>hf_model_cls</th>
      <th>hf_model_kwargs</th>
      <th>...</th>
      <th>unfrozen_lr_max</th>
      <th>unfrozen_lr_min</th>
      <th>use_adjacent_neg_prob</th>
      <th>use_fp16</th>
      <th>use_next_pos_prob</th>
      <th>val_pct</th>
      <th>weight_decay</th>
      <th>valid_loss</th>
      <th>topic_seg_f1_score</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>None</td>
      <td>0.99</td>
      <td>1.000000e-07</td>
      <td>8</td>
      <td>{'p': 0.1, 'dropout_cls': &lt;class 'torch.nn.modules.dropout.Dropout'&gt;}</td>
      <td>0</td>
      <td>{'num_labels': 2}</td>
      <td>microsoft/deberta-v3-small</td>
      <td>AutoModelForSequenceClassification</td>
      <td>{}</td>
      <td>...</td>
      <td>0.001</td>
      <td>0.00001</td>
      <td>0.5</td>
      <td>True</td>
      <td>0.75</td>
      <td>0.25</td>
      <td>0.0</td>
      <td>0.586599</td>
      <td>0.758025</td>
      <td>202.285863</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 39 columns</p>
</div>
</div>
</div>
</section>
<section id="get_preds" class="level3">
<h3 class="anchored" data-anchor-id="get_preds"><code>get_preds</code></h3>
<hr>
<p><a href="https://github.com/ohmeow/fsdl_2022_course_project/blob/master/course_copilot/topic_segmentation.py#L1010" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="topicsegmentationmodeltrainer.get_preds" class="level3">
<h3 class="anchored" data-anchor-id="topicsegmentationmodeltrainer.get_preds">TopicSegmentationModelTrainer.get_preds</h3>
<blockquote class="blockquote">
<pre><code> TopicSegmentationModelTrainer.get_preds (model_or_learner,
                                          data:pandas.core.frame.DataFrame
                                          , **kwargs)</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>model_or_learner</td>
<td></td>
<td>The <code>Learner</code> we want to use for inference</td>
</tr>
<tr class="even">
<td>data</td>
<td>pd.DataFrame</td>
<td>The data we want to get predictions on (must include a column named ‘transcript’ at minimum)</td>
</tr>
<tr class="odd">
<td>kwargs</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>tuple[pd.DataFrame, list[int]]</strong></td>
<td><strong>Returns <code>data</code> (including topic segmentation boundaris and scores) and indicies of predicted topic starts</strong></td>
</tr>
</tbody>
</table>
<p>Example inference code</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>trainer <span class="op">=</span> TopicSegmentationModelTrainer(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"test_topic_segmentation"</span>, ExampleCFG, <span class="st">"../data"</span>, <span class="st">"../models"</span>, <span class="st">"../logs"</span>, verbose<span class="op">=</span><span class="va">True</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># results_df, train_df, val_idxs = trainer.train()</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>inf_learn <span class="op">=</span> trainer.load_learner_or_model(device<span class="op">=</span><span class="st">"cpu"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>preds_df, pred_topic_idxs <span class="op">=</span> trainer.get_preds(inf_learn, inf_df[[<span class="st">"topic"</span>, <span class="st">"transcript"</span>]].copy())</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co"># cleanup resources</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> inf_learn</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>torch.cuda.empty_cache()</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>gc.collect()</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co"># shows final results</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pred_topic_idxs[:<span class="dv">10</span>])</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>preds_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0, 4, 16, 20, 23, 26, 30, 44, 47, 54]</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>topic</th>
      <th>transcript</th>
      <th>depth_score</th>
      <th>threshold</th>
      <th>pred_start</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Using Huggingface</td>
      <td>Hi everybody, and welcome to Practical Deep Learning for Coders Lesson Four, which I think</td>
      <td>0.001369</td>
      <td>0.002255</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Using Huggingface</td>
      <td>is the lesson that a lot of the regulars in the community have been most excited about,</td>
      <td>0.000000</td>
      <td>0.002255</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Using Huggingface</td>
      <td>because it's where we're gonna get some totally new material — totally new topic, we've</td>
      <td>0.000203</td>
      <td>0.002255</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Using Huggingface</td>
      <td>never covered before. We're going to cover natural language processing (NLP), and you'll</td>
      <td>0.001102</td>
      <td>0.002255</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Using Huggingface</td>
      <td>find there, there is indeed a chapter about that in the book, but we're going to do it in a totally different way to how it's done in the book. In the book we do NLP using the</td>
      <td>0.002383</td>
      <td>0.002255</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="tune" class="level3">
<h3 class="anchored" data-anchor-id="tune"><code>tune</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>trainer <span class="op">=</span> TopicSegmentationModelTrainer(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    experiment_name<span class="op">=</span><span class="st">"test_topic_segmentation"</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    train_config<span class="op">=</span>ExampleCFG,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    data_path<span class="op">=</span><span class="st">"../data"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    model_output_path<span class="op">=</span><span class="st">"../models"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    log_output_path<span class="op">=</span><span class="st">"../logs"</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    log_preds<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    log_n_preds<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    use_wandb<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>sweep_id <span class="op">=</span> trainer.configure_sweep(sweep_config<span class="op">=</span>default_sweep_config)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Create sweep with ID: 2nqt78ll
Sweep URL: https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/sweeps/2nqt78ll</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>wandb.agent(sweep_id, function<span class="op">=</span>partial(trainer.train, sweep_config<span class="op">=</span>default_sweep_config), count<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Agent Starting Run: wvxi3n4n with config:
wandb:  unfrozen_lr_max: 0.0002964642653616338
wandb:  unfrozen_lr_min: 8.666728243468805e-05
Failed to detect the name of this notebook, you can set it manually with the WANDB_NOTEBOOK_NAME environment variable to enable code saving.
wandb: WARNING Ignored wandb.init() arg project when running a sweep.
wandb: WARNING Ignored wandb.init() arg entity when running a sweep.</code></pre>
</div>
<div class="cell-output cell-output-display">
wandb version 0.13.4 is available!  To upgrade, please run:
 $ pip install wandb --upgrade
</div>
<div class="cell-output cell-output-display">
Tracking run with wandb version 0.13.3
</div>
<div class="cell-output cell-output-display">
Run data is saved locally in <code>../logs/wandb/run-20221010_131806-wvxi3n4n</code>
</div>
<div class="cell-output cell-output-display">
Syncing run <strong><a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/wvxi3n4n" target="_blank">earthy-sweep-1</a></strong> to <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation" target="_blank">Weights &amp; Biases</a> (<a href="https://wandb.me/run" target="_blank">docs</a>)<br>Sweep page:  <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/sweeps/2nqt78ll" target="_blank">https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/sweeps/2nqt78ll</a>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Experiment: test_topic_segmentation
Training config: f{'accum': None, 'adam_beta2': 0.99, 'adam_eps': 1e-07, 'batch_size': 8, 'custom_model_kwargs': {'p': 0.1, 'dropout_cls': &lt;class 'torch.nn.modules.dropout.Dropout'&gt;}, 'frozen_lr': 0, 'hf_config_kwargs': {'num_labels': 2}, 'hf_model_checkpoint': 'microsoft/deberta-v3-small', 'hf_model_cls': 'AutoModelForSequenceClassification', 'hf_model_kwargs': {}, 'hf_tokenizer_kwargs': {}, 'include_gradient_checkpointing': False, 'include_labels': False, 'lower_case': True, 'max_grad_norm': None, 'max_length': True, 'n_frozen_epochs': 0, 'n_unfrozen_epochs': 2, 'new_special_tokens': None, 'one_cycle_moms_end': 0.8, 'one_cycle_moms_min': 0.7, 'one_cycle_moms_start': 0.8, 'only_seed_splits': True, 'preprocess_strategy': None, 'random_seed': 2022, 'save_best_model': True, 'tok_kwargs': {}, 'training_subset': 0.25, 'truncation_strategy': True, 'unfrozen_lr_max': 0.0002964642653616338, 'unfrozen_lr_min': 8.666728243468805e-05, 'use_adjacent_neg_prob': 0.5, 'use_fp16': True, 'use_next_pos_prob': 0.75, 'val_pct': 0.25, 'weight_decay': 0.0}
Preparing training data ...
Building HF objects ...
Building DataLoaders ...
Building Learner ...
Training ...</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>topic_seg_f1_score</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.434889</td>
      <td>0.607325</td>
      <td>0.763786</td>
      <td>01:27</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.297782</td>
      <td>0.579850</td>
      <td>0.768724</td>
      <td>01:27</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Better model found at epoch 0 with valid_loss value: 0.6073254942893982.
Better model found at epoch 1 with valid_loss value: 0.5798501968383789.</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-stdout">
<pre><code>End training</code></pre>
</div>
<div class="cell-output cell-output-display">
Waiting for W&amp;B process to finish... <strong style="color:green">(success).</strong>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ee1a303a10224751b82344a37f590134","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">

<style>
    table.wandb td:nth-child(1) { padding: 0 10px; text-align: left ; width: auto;} td:nth-child(2) {text-align: left ; width: 100%}
    .wandb-row { display: flex; flex-direction: row; flex-wrap: wrap; justify-content: flex-start; width: 100% }
    .wandb-col { display: flex; flex-direction: column; flex-basis: 100%; flex: 1; padding: 10px; }
    </style>
<div class="wandb-row"><div class="wandb-col"><h3 class="anchored">Run history:</h3><br><table class="wandb"><tbody><tr><td>topic_seg_f1_score</td><td>▁</td></tr><tr><td>valid_loss</td><td>▁</td></tr></tbody></table><br></div><div class="wandb-col"><h3 class="anchored">Run summary:</h3><br><table class="wandb"><tbody><tr><td>topic_seg_f1_score</td><td>0.77366</td></tr><tr><td>valid_loss</td><td>0.58265</td></tr></tbody></table><br></div></div>
</div>
<div class="cell-output cell-output-display">
Synced <strong style="color:#cdcd00">earthy-sweep-1</strong>: <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/wvxi3n4n" target="_blank">https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/wvxi3n4n</a><br>Synced 6 W&amp;B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
</div>
<div class="cell-output cell-output-display">
Find logs at: <code>../logs/wandb/run-20221010_131806-wvxi3n4n/logs</code>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Agent Starting Run: l5r5816d with config:
wandb:  unfrozen_lr_max: 0.0002667648067607438
wandb:  unfrozen_lr_min: 4.856146061559808e-05
Failed to detect the name of this notebook, you can set it manually with the WANDB_NOTEBOOK_NAME environment variable to enable code saving.
wandb: WARNING Ignored wandb.init() arg project when running a sweep.
wandb: WARNING Ignored wandb.init() arg entity when running a sweep.</code></pre>
</div>
<div class="cell-output cell-output-display">
wandb version 0.13.4 is available!  To upgrade, please run:
 $ pip install wandb --upgrade
</div>
<div class="cell-output cell-output-display">
Tracking run with wandb version 0.13.3
</div>
<div class="cell-output cell-output-display">
Run data is saved locally in <code>../logs/wandb/run-20221010_132215-l5r5816d</code>
</div>
<div class="cell-output cell-output-display">
Syncing run <strong><a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/l5r5816d" target="_blank">rich-sweep-2</a></strong> to <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation" target="_blank">Weights &amp; Biases</a> (<a href="https://wandb.me/run" target="_blank">docs</a>)<br>Sweep page:  <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/sweeps/2nqt78ll" target="_blank">https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/sweeps/2nqt78ll</a>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Experiment: test_topic_segmentation
Training config: f{'accum': None, 'adam_beta2': 0.99, 'adam_eps': 1e-07, 'batch_size': 8, 'custom_model_kwargs': {'p': 0.1, 'dropout_cls': &lt;class 'torch.nn.modules.dropout.Dropout'&gt;}, 'frozen_lr': 0, 'hf_config_kwargs': {'num_labels': 2}, 'hf_model_checkpoint': 'microsoft/deberta-v3-small', 'hf_model_cls': 'AutoModelForSequenceClassification', 'hf_model_kwargs': {}, 'hf_tokenizer_kwargs': {}, 'include_gradient_checkpointing': False, 'include_labels': False, 'lower_case': True, 'max_grad_norm': None, 'max_length': True, 'n_frozen_epochs': 0, 'n_unfrozen_epochs': 2, 'new_special_tokens': None, 'one_cycle_moms_end': 0.8, 'one_cycle_moms_min': 0.7, 'one_cycle_moms_start': 0.8, 'only_seed_splits': True, 'preprocess_strategy': None, 'random_seed': 2022, 'save_best_model': True, 'tok_kwargs': {}, 'training_subset': 0.25, 'truncation_strategy': True, 'unfrozen_lr_max': 0.0002667648067607438, 'unfrozen_lr_min': 4.856146061559808e-05, 'use_adjacent_neg_prob': 0.5, 'use_fp16': True, 'use_next_pos_prob': 0.75, 'val_pct': 0.25, 'weight_decay': 0.0}
Preparing training data ...
Building HF objects ...
Building DataLoaders ...
Building Learner ...
Training ...</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>topic_seg_f1_score</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.395206</td>
      <td>0.567065</td>
      <td>0.772840</td>
      <td>01:25</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.289024</td>
      <td>0.579308</td>
      <td>0.767901</td>
      <td>01:25</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Better model found at epoch 0 with valid_loss value: 0.5670649409294128.</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-stdout">
<pre><code>End training</code></pre>
</div>
<div class="cell-output cell-output-display">
Waiting for W&amp;B process to finish... <strong style="color:green">(success).</strong>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b2c69e77c8414bb49870bc5410a40344","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">

<style>
    table.wandb td:nth-child(1) { padding: 0 10px; text-align: left ; width: auto;} td:nth-child(2) {text-align: left ; width: 100%}
    .wandb-row { display: flex; flex-direction: row; flex-wrap: wrap; justify-content: flex-start; width: 100% }
    .wandb-col { display: flex; flex-direction: column; flex-basis: 100%; flex: 1; padding: 10px; }
    </style>
<div class="wandb-row"><div class="wandb-col"><h3 class="anchored">Run history:</h3><br><table class="wandb"><tbody><tr><td>topic_seg_f1_score</td><td>▁</td></tr><tr><td>valid_loss</td><td>▁</td></tr></tbody></table><br></div><div class="wandb-col"><h3 class="anchored">Run summary:</h3><br><table class="wandb"><tbody><tr><td>topic_seg_f1_score</td><td>0.75802</td></tr><tr><td>valid_loss</td><td>0.59401</td></tr></tbody></table><br></div></div>
</div>
<div class="cell-output cell-output-display">
Synced <strong style="color:#cdcd00">rich-sweep-2</strong>: <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/l5r5816d" target="_blank">https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/l5r5816d</a><br>Synced 6 W&amp;B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
</div>
<div class="cell-output cell-output-display">
Find logs at: <code>../logs/wandb/run-20221010_132215-l5r5816d/logs</code>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Agent Starting Run: 3x9bljp5 with config:
wandb:  unfrozen_lr_max: 0.00014688870658243158
wandb:  unfrozen_lr_min: 9.855246064537064e-05
Failed to detect the name of this notebook, you can set it manually with the WANDB_NOTEBOOK_NAME environment variable to enable code saving.
wandb: WARNING Ignored wandb.init() arg project when running a sweep.
wandb: WARNING Ignored wandb.init() arg entity when running a sweep.</code></pre>
</div>
<div class="cell-output cell-output-display">
wandb version 0.13.4 is available!  To upgrade, please run:
 $ pip install wandb --upgrade
</div>
<div class="cell-output cell-output-display">
Tracking run with wandb version 0.13.3
</div>
<div class="cell-output cell-output-display">
Run data is saved locally in <code>../logs/wandb/run-20221010_132551-3x9bljp5</code>
</div>
<div class="cell-output cell-output-display">
Syncing run <strong><a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/3x9bljp5" target="_blank">true-sweep-3</a></strong> to <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation" target="_blank">Weights &amp; Biases</a> (<a href="https://wandb.me/run" target="_blank">docs</a>)<br>Sweep page:  <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/sweeps/2nqt78ll" target="_blank">https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/sweeps/2nqt78ll</a>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Experiment: test_topic_segmentation
Training config: f{'accum': None, 'adam_beta2': 0.99, 'adam_eps': 1e-07, 'batch_size': 8, 'custom_model_kwargs': {'p': 0.1, 'dropout_cls': &lt;class 'torch.nn.modules.dropout.Dropout'&gt;}, 'frozen_lr': 0, 'hf_config_kwargs': {'num_labels': 2}, 'hf_model_checkpoint': 'microsoft/deberta-v3-small', 'hf_model_cls': 'AutoModelForSequenceClassification', 'hf_model_kwargs': {}, 'hf_tokenizer_kwargs': {}, 'include_gradient_checkpointing': False, 'include_labels': False, 'lower_case': True, 'max_grad_norm': None, 'max_length': True, 'n_frozen_epochs': 0, 'n_unfrozen_epochs': 2, 'new_special_tokens': None, 'one_cycle_moms_end': 0.8, 'one_cycle_moms_min': 0.7, 'one_cycle_moms_start': 0.8, 'only_seed_splits': True, 'preprocess_strategy': None, 'random_seed': 2022, 'save_best_model': True, 'tok_kwargs': {}, 'training_subset': 0.25, 'truncation_strategy': True, 'unfrozen_lr_max': 0.00014688870658243158, 'unfrozen_lr_min': 9.855246064537064e-05, 'use_adjacent_neg_prob': 0.5, 'use_fp16': True, 'use_next_pos_prob': 0.75, 'val_pct': 0.25, 'weight_decay': 0.0}
Preparing training data ...
Building HF objects ...
Building DataLoaders ...
Building Learner ...
Training ...</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>topic_seg_f1_score</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.457043</td>
      <td>0.659170</td>
      <td>0.729218</td>
      <td>01:25</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.266419</td>
      <td>0.602764</td>
      <td>0.770370</td>
      <td>01:25</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Better model found at epoch 0 with valid_loss value: 0.6591702103614807.
Better model found at epoch 1 with valid_loss value: 0.6027644276618958.</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-stdout">
<pre><code>End training</code></pre>
</div>
<div class="cell-output cell-output-display">
Waiting for W&amp;B process to finish... <strong style="color:green">(success).</strong>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c5752e7d79b9446f868e1fd2efc38e2e","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">

<style>
    table.wandb td:nth-child(1) { padding: 0 10px; text-align: left ; width: auto;} td:nth-child(2) {text-align: left ; width: 100%}
    .wandb-row { display: flex; flex-direction: row; flex-wrap: wrap; justify-content: flex-start; width: 100% }
    .wandb-col { display: flex; flex-direction: column; flex-basis: 100%; flex: 1; padding: 10px; }
    </style>
<div class="wandb-row"><div class="wandb-col"><h3 class="anchored">Run history:</h3><br><table class="wandb"><tbody><tr><td>topic_seg_f1_score</td><td>▁</td></tr><tr><td>valid_loss</td><td>▁</td></tr></tbody></table><br></div><div class="wandb-col"><h3 class="anchored">Run summary:</h3><br><table class="wandb"><tbody><tr><td>topic_seg_f1_score</td><td>0.75473</td></tr><tr><td>valid_loss</td><td>0.62178</td></tr></tbody></table><br></div></div>
</div>
<div class="cell-output cell-output-display">
Synced <strong style="color:#cdcd00">true-sweep-3</strong>: <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/3x9bljp5" target="_blank">https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/3x9bljp5</a><br>Synced 6 W&amp;B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
</div>
<div class="cell-output cell-output-display">
Find logs at: <code>../logs/wandb/run-20221010_132551-3x9bljp5/logs</code>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Agent Starting Run: xf8n2hrc with config:
wandb:  unfrozen_lr_max: 0.0008400970402462487
wandb:  unfrozen_lr_min: 8.196114939228642e-05
Failed to detect the name of this notebook, you can set it manually with the WANDB_NOTEBOOK_NAME environment variable to enable code saving.
wandb: WARNING Ignored wandb.init() arg project when running a sweep.
wandb: WARNING Ignored wandb.init() arg entity when running a sweep.</code></pre>
</div>
<div class="cell-output cell-output-display">
wandb version 0.13.4 is available!  To upgrade, please run:
 $ pip install wandb --upgrade
</div>
<div class="cell-output cell-output-display">
Tracking run with wandb version 0.13.3
</div>
<div class="cell-output cell-output-display">
Run data is saved locally in <code>../logs/wandb/run-20221010_132924-xf8n2hrc</code>
</div>
<div class="cell-output cell-output-display">
Syncing run <strong><a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/xf8n2hrc" target="_blank">atomic-sweep-4</a></strong> to <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation" target="_blank">Weights &amp; Biases</a> (<a href="https://wandb.me/run" target="_blank">docs</a>)<br>Sweep page:  <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/sweeps/2nqt78ll" target="_blank">https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/sweeps/2nqt78ll</a>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Experiment: test_topic_segmentation
Training config: f{'accum': None, 'adam_beta2': 0.99, 'adam_eps': 1e-07, 'batch_size': 8, 'custom_model_kwargs': {'p': 0.1, 'dropout_cls': &lt;class 'torch.nn.modules.dropout.Dropout'&gt;}, 'frozen_lr': 0, 'hf_config_kwargs': {'num_labels': 2}, 'hf_model_checkpoint': 'microsoft/deberta-v3-small', 'hf_model_cls': 'AutoModelForSequenceClassification', 'hf_model_kwargs': {}, 'hf_tokenizer_kwargs': {}, 'include_gradient_checkpointing': False, 'include_labels': False, 'lower_case': True, 'max_grad_norm': None, 'max_length': True, 'n_frozen_epochs': 0, 'n_unfrozen_epochs': 2, 'new_special_tokens': None, 'one_cycle_moms_end': 0.8, 'one_cycle_moms_min': 0.7, 'one_cycle_moms_start': 0.8, 'only_seed_splits': True, 'preprocess_strategy': None, 'random_seed': 2022, 'save_best_model': True, 'tok_kwargs': {}, 'training_subset': 0.25, 'truncation_strategy': True, 'unfrozen_lr_max': 0.0008400970402462487, 'unfrozen_lr_min': 8.196114939228642e-05, 'use_adjacent_neg_prob': 0.5, 'use_fp16': True, 'use_next_pos_prob': 0.75, 'val_pct': 0.25, 'weight_decay': 0.0}
Preparing training data ...
Building HF objects ...
Building DataLoaders ...
Building Learner ...
Training ...</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>topic_seg_f1_score</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.396438</td>
      <td>0.553289</td>
      <td>0.798354</td>
      <td>01:25</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.272380</td>
      <td>0.460504</td>
      <td>0.811523</td>
      <td>01:25</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Better model found at epoch 0 with valid_loss value: 0.5532887578010559.
Better model found at epoch 1 with valid_loss value: 0.4605042636394501.</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-stdout">
<pre><code>End training</code></pre>
</div>
<div class="cell-output cell-output-display">
Waiting for W&amp;B process to finish... <strong style="color:green">(success).</strong>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"223f45460ae442599815de30ca6959f8","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">

<style>
    table.wandb td:nth-child(1) { padding: 0 10px; text-align: left ; width: auto;} td:nth-child(2) {text-align: left ; width: 100%}
    .wandb-row { display: flex; flex-direction: row; flex-wrap: wrap; justify-content: flex-start; width: 100% }
    .wandb-col { display: flex; flex-direction: column; flex-basis: 100%; flex: 1; padding: 10px; }
    </style>
<div class="wandb-row"><div class="wandb-col"><h3 class="anchored">Run history:</h3><br><table class="wandb"><tbody><tr><td>topic_seg_f1_score</td><td>▁</td></tr><tr><td>valid_loss</td><td>▁</td></tr></tbody></table><br></div><div class="wandb-col"><h3 class="anchored">Run summary:</h3><br><table class="wandb"><tbody><tr><td>topic_seg_f1_score</td><td>0.80658</td></tr><tr><td>valid_loss</td><td>0.46773</td></tr></tbody></table><br></div></div>
</div>
<div class="cell-output cell-output-display">
Synced <strong style="color:#cdcd00">atomic-sweep-4</strong>: <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/xf8n2hrc" target="_blank">https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/xf8n2hrc</a><br>Synced 6 W&amp;B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
</div>
<div class="cell-output cell-output-display">
Find logs at: <code>../logs/wandb/run-20221010_132924-xf8n2hrc/logs</code>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Agent Starting Run: 6kb77a8z with config:
wandb:  unfrozen_lr_max: 0.0006178585838591866
wandb:  unfrozen_lr_min: 1.6556729698366223e-05
Failed to detect the name of this notebook, you can set it manually with the WANDB_NOTEBOOK_NAME environment variable to enable code saving.
wandb: WARNING Ignored wandb.init() arg project when running a sweep.
wandb: WARNING Ignored wandb.init() arg entity when running a sweep.</code></pre>
</div>
<div class="cell-output cell-output-display">
wandb version 0.13.4 is available!  To upgrade, please run:
 $ pip install wandb --upgrade
</div>
<div class="cell-output cell-output-display">
Tracking run with wandb version 0.13.3
</div>
<div class="cell-output cell-output-display">
Run data is saved locally in <code>../logs/wandb/run-20221010_133257-6kb77a8z</code>
</div>
<div class="cell-output cell-output-display">
Syncing run <strong><a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/6kb77a8z" target="_blank">splendid-sweep-5</a></strong> to <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation" target="_blank">Weights &amp; Biases</a> (<a href="https://wandb.me/run" target="_blank">docs</a>)<br>Sweep page:  <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/sweeps/2nqt78ll" target="_blank">https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/sweeps/2nqt78ll</a>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Experiment: test_topic_segmentation
Training config: f{'accum': None, 'adam_beta2': 0.99, 'adam_eps': 1e-07, 'batch_size': 8, 'custom_model_kwargs': {'p': 0.1, 'dropout_cls': &lt;class 'torch.nn.modules.dropout.Dropout'&gt;}, 'frozen_lr': 0, 'hf_config_kwargs': {'num_labels': 2}, 'hf_model_checkpoint': 'microsoft/deberta-v3-small', 'hf_model_cls': 'AutoModelForSequenceClassification', 'hf_model_kwargs': {}, 'hf_tokenizer_kwargs': {}, 'include_gradient_checkpointing': False, 'include_labels': False, 'lower_case': True, 'max_grad_norm': None, 'max_length': True, 'n_frozen_epochs': 0, 'n_unfrozen_epochs': 2, 'new_special_tokens': None, 'one_cycle_moms_end': 0.8, 'one_cycle_moms_min': 0.7, 'one_cycle_moms_start': 0.8, 'only_seed_splits': True, 'preprocess_strategy': None, 'random_seed': 2022, 'save_best_model': True, 'tok_kwargs': {}, 'training_subset': 0.25, 'truncation_strategy': True, 'unfrozen_lr_max': 0.0006178585838591866, 'unfrozen_lr_min': 1.6556729698366223e-05, 'use_adjacent_neg_prob': 0.5, 'use_fp16': True, 'use_next_pos_prob': 0.75, 'val_pct': 0.25, 'weight_decay': 0.0}
Preparing training data ...
Building HF objects ...
Building DataLoaders ...
Building Learner ...
Training ...</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>topic_seg_f1_score</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.423982</td>
      <td>0.563763</td>
      <td>0.781893</td>
      <td>01:26</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.333860</td>
      <td>0.548688</td>
      <td>0.783539</td>
      <td>01:26</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Better model found at epoch 0 with valid_loss value: 0.5637626647949219.
Better model found at epoch 1 with valid_loss value: 0.5486881136894226.</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-stdout">
<pre><code>End training</code></pre>
</div>
<div class="cell-output cell-output-display">
Waiting for W&amp;B process to finish... <strong style="color:green">(success).</strong>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cf69bb610b304d5d8d23a4836641f84a","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">

<style>
    table.wandb td:nth-child(1) { padding: 0 10px; text-align: left ; width: auto;} td:nth-child(2) {text-align: left ; width: 100%}
    .wandb-row { display: flex; flex-direction: row; flex-wrap: wrap; justify-content: flex-start; width: 100% }
    .wandb-col { display: flex; flex-direction: column; flex-basis: 100%; flex: 1; padding: 10px; }
    </style>
<div class="wandb-row"><div class="wandb-col"><h3 class="anchored">Run history:</h3><br><table class="wandb"><tbody><tr><td>topic_seg_f1_score</td><td>▁</td></tr><tr><td>valid_loss</td><td>▁</td></tr></tbody></table><br></div><div class="wandb-col"><h3 class="anchored">Run summary:</h3><br><table class="wandb"><tbody><tr><td>topic_seg_f1_score</td><td>0.78354</td></tr><tr><td>valid_loss</td><td>0.56118</td></tr></tbody></table><br></div></div>
</div>
<div class="cell-output cell-output-display">
Synced <strong style="color:#cdcd00">splendid-sweep-5</strong>: <a href="https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/6kb77a8z" target="_blank">https://wandb.ai/course-copilot/course-copilot-ml-topic_segmentation/runs/6kb77a8z</a><br>Synced 6 W&amp;B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
</div>
<div class="cell-output cell-output-display">
Find logs at: <code>../logs/wandb/run-20221010_133257-6kb77a8z/logs</code>
</div>
</div>
</section>
<section id="tune_threshold" class="level3">
<h3 class="anchored" data-anchor-id="tune_threshold"><code>tune_threshold</code></h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>